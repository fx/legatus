<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gatus Status</title>
    <link rel="stylesheet" href="/styles.css" />
    <script src="/lib/htmx.min.js"></script>
    <script src="/lib/mustache.min.js"></script>
    <script src="/lib/client-side-templates.js"></script>
  </head>
  <body>
    <div class="terminal">
      <header class="terminal-header">
        <span class="terminal-title">[ GATUS STATUS MONITOR ]</span>
      </header>

      <!-- Mustache template for endpoints -->
      <template id="endpoints-template">
        <table class="status-table">
          <thead>
            <tr>
              <th class="col-status">STATUS</th>
              <th class="col-name">NAME</th>
              <th class="col-group">GROUP</th>
              <th class="col-response">RESPONSE</th>
            </tr>
          </thead>
          <tbody>
            {{#endpoints}}
            <tr class="status-row">
              <td class="col-status">
                <button
                  type="button"
                  class="status-icon status-icon-{{statusClass}}"
                  aria-label="{{name}}{{#group}} ({{group}}){{/group}}: {{statusLabel}}"
                  popovertarget="popover-{{index}}"
                >[{{statusIcon}}]</button>
              </td>
              <td class="col-name">{{name}}</td>
              <td class="col-group">{{#group}}{{group}}{{/group}}{{^group}}--{{/group}}</td>
              <td class="col-response">{{#formattedDuration}}{{formattedDuration}}{{/formattedDuration}}{{^formattedDuration}}--{{/formattedDuration}}</td>
            </tr>
            <div
              id="popover-{{index}}"
              popover="auto"
              class="status-popover"
            >
              <div class="popover-header">
                <span class="popover-name">{{name}}</span>
                <span class="status-badge status-badge-{{statusClass}}">[{{statusIcon}}]</span>
              </div>
              {{#group}}
              <div class="popover-group">Group: {{group}}</div>
              {{/group}}
              {{#hasResult}}
              <div class="popover-details">
                <div class="detail-row">
                  <span class="detail-label">Response:</span>
                  <span class="detail-value">{{formattedDuration}}</span>
                </div>
                {{#httpStatus}}
                <div class="detail-row">
                  <span class="detail-label">HTTP:</span>
                  <span class="detail-value">{{httpStatus}}</span>
                </div>
                {{/httpStatus}}
                <div class="detail-row">
                  <span class="detail-label">Checked:</span>
                  <span class="detail-value">{{formattedTimestamp}}</span>
                </div>
                {{#hasConditions}}
                <div class="conditions-section">
                  <div class="conditions-title">--- Conditions ---</div>
                  <ul class="conditions-list">
                    {{#conditions}}
                    <li class="condition-item">
                      <span class="{{iconClass}}">{{icon}}</span>
                      <code class="condition-text">{{condition}}</code>
                    </li>
                    {{/conditions}}
                  </ul>
                </div>
                {{/hasConditions}}
              </div>
              {{/hasResult}}
              {{^hasResult}}
              <div class="no-results">[NO DATA]</div>
              {{/hasResult}}
            </div>
            {{/endpoints}}
          </tbody>
        </table>
      </template>

      <!-- Main container with HTMX -->
      <div
        id="app"
        hx-ext="client-side-templates"
        hx-get="/api/v1/endpoints/statuses"
        hx-trigger="load, every 30s"
        mustache-template="endpoints-template"
      >
        <div class="loading-container">
          <span class="loading-text">Loading...</span>
        </div>
      </div>

      <footer class="terminal-footer">
        <span>Auto-refresh: 30s</span>
        <span>|</span>
        <span id="timestamp"></span>
      </footer>
    </div>

    <script type="module" src="/dist/app.js"></script>
    <script>
      function updateTimestamp() {
        const el = document.getElementById('timestamp');
        if (el) {
          const now = new Date();
          el.textContent = now.toLocaleTimeString();
        }
      }
      updateTimestamp();
      setInterval(updateTimestamp, 1000);
    </script>
  </body>
</html>
