<!doctype html>
<html lang="en" data-webtui-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gatus Status</title>
    <!-- WebTUI CSS -->
    <style>
      @layer base, utils, components;
      @import 'https://cdn.jsdelivr.net/npm/@webtui/css@0.1.5/dist/base.css';
      @import 'https://cdn.jsdelivr.net/npm/@webtui/css@0.1.5/dist/utils/box.css';
      @import 'https://cdn.jsdelivr.net/npm/@webtui/css@0.1.5/dist/components/table.css';
      @import 'https://cdn.jsdelivr.net/npm/@webtui/css@0.1.5/dist/components/button.css';
      @import 'https://cdn.jsdelivr.net/npm/@webtui/css@0.1.5/dist/components/badge.css';
      @import 'https://cdn.jsdelivr.net/npm/@webtui/css@0.1.5/dist/components/typography.css';
      @import 'https://cdn.jsdelivr.net/npm/@webtui/css@0.1.5/dist/components/separator.css';
      @import 'https://cdn.jsdelivr.net/npm/@webtui/css@0.1.5/dist/components/spinner.css';
    </style>
    <link rel="stylesheet" href="/styles.css" />
    <script src="/lib/htmx.min.js"></script>
    <script src="/lib/mustache.min.js"></script>
    <script src="/lib/client-side-templates.js"></script>
  </head>
  <body>
    <div class="terminal-container">
      <!-- Header -->
      <header box-="square" class="terminal-header">
        <h1>[ GATUS STATUS MONITOR ]</h1>
      </header>

      <!-- Mustache template for endpoints -->
      <template id="endpoints-template">
        <table>
          <thead>
            <tr>
              <th class="col-status">STATUS</th>
              <th class="col-name">NAME</th>
              <th class="col-group">GROUP</th>
              <th class="col-response">RESPONSE</th>
            </tr>
          </thead>
          <tbody>
            {{#endpoints}}
            <tr>
              <td class="col-status">
                <button
                  type="button"
                  class="status-btn status-{{statusClass}}"
                  aria-label="{{name}}{{#group}} ({{group}}){{/group}}: {{statusLabel}}"
                  popovertarget="popover-{{index}}"
                >[{{statusIcon}}]</button>
              </td>
              <td class="col-name">{{name}}</td>
              <td class="col-group muted">{{#group}}{{group}}{{/group}}{{^group}}--{{/group}}</td>
              <td class="col-response">{{#formattedDuration}}{{formattedDuration}}{{/formattedDuration}}{{^formattedDuration}}--{{/formattedDuration}}</td>
            </tr>
            {{/endpoints}}
          </tbody>
        </table>
        <!-- Popovers must be outside table for valid HTML -->
        {{#endpoints}}
        <div
          id="popover-{{index}}"
          popover="auto"
          class="status-popover"
          box-="square"
        >
          <div class="popover-header">
            <strong class="popover-name">{{name}}</strong>
            <span is-="badge" class="status-badge-{{statusClass}}">[{{statusIcon}}]</span>
          </div>
          <hr is-="separator" />
          {{#group}}
          <div class="popover-group muted">Group: {{group}}</div>
          {{/group}}
          {{#hasResult}}
          <div class="popover-details">
            <div class="detail-row">
              <span class="muted">Response:</span>
              <span>{{formattedDuration}}</span>
            </div>
            {{#httpStatus}}
            <div class="detail-row">
              <span class="muted">HTTP:</span>
              <span>{{httpStatus}}</span>
            </div>
            {{/httpStatus}}
            <div class="detail-row">
              <span class="muted">Checked:</span>
              <span>{{formattedTimestamp}}</span>
            </div>
            {{#hasConditions}}
            <hr is-="separator" />
            <div class="conditions-section">
              <div class="conditions-title muted">--- Conditions ---</div>
              <ul class="conditions-list">
                {{#conditions}}
                <li class="condition-item">
                  <span class="{{iconClass}}">{{icon}}</span>
                  <code>{{condition}}</code>
                </li>
                {{/conditions}}
              </ul>
            </div>
            {{/hasConditions}}
          </div>
          {{/hasResult}}
          {{^hasResult}}
          <div class="no-results muted">[NO DATA]</div>
          {{/hasResult}}
        </div>
        {{/endpoints}}
      </template>

      <!-- Main container with HTMX -->
      <div
        id="app"
        box-="square"
        class="main-content"
        hx-ext="client-side-templates"
        hx-get="/api/v1/endpoints/statuses"
        hx-trigger="load, every 30s"
        mustache-template="endpoints-template"
      >
        <div class="loading-container">
          <span is-="spinner"></span>
          <span class="loading-text">Loading...</span>
        </div>
      </div>

      <!-- Footer -->
      <footer box-="square" class="terminal-footer">
        <span class="muted">Auto-refresh: 30s</span>
        <span class="muted">|</span>
        <span id="timestamp" class="muted"></span>
      </footer>
    </div>

    <script type="module" src="/dist/app.js"></script>
    <script>
      function updateTimestamp() {
        const el = document.getElementById('timestamp');
        if (el) {
          const now = new Date();
          el.textContent = now.toLocaleTimeString();
        }
      }
      updateTimestamp();
      setInterval(updateTimestamp, 1000);
    </script>
  </body>
</html>
